\documentclass{eplDoc}



\newcommand{\docType}	{Assignment 3}
\newcommand{\docDate}	{23/03/2012}
\newcommand{\docAuthor}	{gr16 : Mulders Corentin, Pelsser Francois}
\newcommand{\courseCode}{LINGI2365}
\newcommand{\courseName}{Constraint programming}
\usepackage{syntax}

\lstset{breaklines=true, breakatwhitespace=false}

\begin{document}
\maketitle
\newpage

\section{Questions}
\subsection{DC3} %1.5 pt
To express the complexity values we use the following notations from the course : $e$ is the number of constraints, $d$ is the size of the domain of the variable with the greatest domain, $r$ is the greatest arity amongst the constraints.
\subsubsection{Time complexity}
The time complexity for DC3 is $O(er^3d^{r+1})$ (if all constraints are binary then $r=2$ and the complexity becomes $O(ed^3)$). \\ 
This is because propagate can be called up to $ed$ times in propagateQueueCDC if every constraints are added to Q for every value removed from the domain of the variable with the greatest domain size. And the complexity of propagateDC3 is $O(r^2d^r)$. That is because the two forall make it so the constraint check is executed $rd$ times. And the check itself needs to try the constraint, which can be done with an $O(r)$ time complexity, on all the combinations of values for the variables and there are $d^{r-1}$ possible combinatiosn since one variable already has its value fixed.


\subsubsection{Space complexity}
The space complexity for DC3 is $O(e)$ because of the queue Q that contains the constraints for which the domain consistency is not guaranteed.  

\subsubsection{Time complexity if all constraints are domain consistent on call}

The complexity if all constraints are domain consistent at the beginning would be $O(er^3d^r)$. The complexity of the propagateDC3 function doesn't change since it still has to check the constraints to make sure they are domain consistent. However in propagateQueueCDC we will only call propagate up to $e$ times and not $ed$ since there will never be any constraint added to Q because the domains won't change, wich is why the complexity is divided by $d$. 

\subsection{valRemoveAC4} %1 pt
We test that $a \in D(x)$ because the data structure $S$ is not updated when the domains are pruned. So it is necessary to verify that $a$ is still in the domain of $x$. \\ 
If this check was removed the algorithm would still work, the $nbSupport[x,a,c]--;$ and adding $(x,a)$ to $\Delta$ wouldn't change anything since $a$ isn't in the domain of $x$ anymore already. \\ 
The time complexity of AC4 wouldn't change without this check. It would still be $O(ed^2)$. This is because the worst case scenario is unaffected by the removal of this check. The check only improves performance in some cases but not in worst case. 

\subsection{Domain and bound consistency} % 0? pt
\subsubsection{Definition of domain consistency }
The set of inconsistent values for X and Y would be defined as follow : 
$$Inc(c) = \{(X, x)|x \in D(X) \wedge \forall y \in D(Y) : \neg(x+y= a)\} \cup \{(Y, y)|y \in D(Y) \wedge \forall x \in D(X) : \neg(x+y = a)\}$$
The constraint is domain consistent with regard to D(X) and D(Y) iff $Inc(c) = \emptyset$. 
\subsubsection{Definition of bound consistency}
The constraint is bound consistent with regard to D(X) and D(Y) iff : 
$$\forall x \in \{ min(D(X)), max(D(X))\} : \exists y \in [min(D(Y)), max(D(Y))] : x+y=a$$ and
$$\forall y \in \{ min(D(Y)), max(D(Y))\} : \exists x \in [min(D(X)), max(D(X))] : x+y=a$$
%$$\forall x \in D(X) : x \in [a- max(D(Y)), a- min(D(Y))]$$
% and $$\forall y \in D(Y) : y \in [a- max(D(X)), a- min(D(X))]$$
\subsubsection{Is the constraint automaticaly bound consistent if domain consistent}
Yes, the domain consistency definition of the constraint is more restrictive than the bound consistency one. If $Inc(c) = \emptyset$ for the domain consistency then the conditiosn for bound consistency are guaranteed to be met. 


\section{Problems}

\subsection{AC3 propagator : AC3Geq.co} %2.5 pt

\subsubsection{Definition of domain consistency}
The set of inconsistent values for X and Y is defined as follow : 
$$Inc(c) = \{(X, x)|x \in D(X) \wedge \forall y \in D(Y) : \neg(x\geq y+a)\} \cup \{(Y, y)|y \in D(Y) \wedge \forall x \in D(X) : \neg(x\geq y+a)\}$$
The constraint is domain consistent with regard to D(X) and D(Y) iff $Inc(c) = \emptyset$. 

\subsubsection{Equivalence of domain consistency and bound consistency}
The domain consistency and bound consistency are equivalent for this constraint. To prove this we must prove that if it is domain consistent then it is also bound consistent as well as the opposite. \\ \\ 
First let's define the bound consistency for this constraint, it is bound consistent with regard to D(X) and D(Y) iff :
$$\forall x \in \{ min(D(X)), max(D(X))\} : \exists y \in [min(D(Y)), max(D(Y))] : x \geq y+a$$ and
$$\forall y \in \{ min(D(Y)), max(D(Y))\} : \exists x \in [min(D(X)), max(D(X))] : x \geq y+a$$
Now let's go back to the domain consistency definition. We notice from our definition $Inc(c)$ that the elements that are not in $Inc(c)$ are : 
$$\{(X, x)|x \in D(X) : \exists y \in D(Y) : x \geq y+a\} \cup \{(Y, y)|y \in D(Y) : \exists x \in D(X) : x \geq y+a\}$$
So if the constraint is domain consistent then :
$$\forall x \in D(X) : \exists y \in D(Y) : x \geq y+a$$ and
$$\forall y \in D(Y) : \exists x \in D(X) : x \geq y+a$$
And if something is true $\forall x\in D(X)$ then it is also true for $x \in \{ min(D(X)), max(D(X))\}$ and if $x \in D(X)$ then $x \in [min(D(X)), max(D(X))]$, the same holds for y. By replacing these in the previous expressions we obtain a weaker version of the domain consistency definition that matches the bound consistency definition. So the domain consistency guarantees the bound consistency. \\ 
We now need to prove that the bound consistency also guarantees the domain consistency for this constraint. Since the constraint is made of a "`greater or equal"' relation we can simplify the domain consistency to verify the constraint for the worst case only instead of on all values from the domains. This leads to the following requirements for domain consistency : 
$$ \exists y \in D(Y) : min(D(X)) \geq y+a$$ and
$$ \exists x \in D(X) : x \geq max(D(Y))+a$$
And if we have bound consistency by its definition we know that for $x=min(D(X)) : \exists y \in [min(D(Y)), max(D(Y))] : x \geq y+a$ once again since we have a "`greater or equal"' then if $\exists y \in [min(D(Y)), max(D(Y))]: x \geq y+a$ we know that $x \geq min(D(Y))+a$ and obviously $min(D(Y))\in D(Y)$. The same is true for Y by smmetry so our new requirement for domain consistency are sure to be met if we have bound consistency. \\ 
Since the bound consistency guarantees the domain consistency for this constraint and the domain consistency guarantees the bound consistency, the two are equivalents.  



\subsubsection{Implementation of a constraint-based propagator in comet}
%TODO faut peut etre rien mettre dans le rapport en fait
\subsection{The channeling constraint : Channeling.co} %4.5 pt
\subsubsection{Definition of domain consistency for this constraint}
The set of inconsistent values for X and Y is defined as follow : 

\begin{align*}
Inc(c) = & \{(X[], x[i])|x[i] \in D(X[]) \wedge \forall y \in D(Y) : \neg(x[i]=(y==i))\} \\
 & \cup \{(Y, y)|y \in D(Y) \wedge \forall x[i] \in D(X[]) : \neg(x[i]=(y==i))\} 
\end{align*}

The constraint is domain consistent with regard to D(X) and D(Y) iff $Inc(c) = \emptyset$. 
\subsubsection{Comet implementation}

\subsection{AC2001 propagator} %4.5 pt

\subsubsection{Generic constraint}

\paragraph{Adding the first support data structure}

\paragraph{Body of the constructor}

\paragraph{Body of the post method}

\paragraph{Body of the propagate method}

\subsubsection{Specific constraints}

\subsection{The AllDifferent constraint : AllDiffFC.co} %6 pt

\subsubsection{Forward-checking consistency}

\subsubsection{Propagator ensuring forward-checking consistency}

\subsubsection{Modification of the NqueensFC.co to use our implementation of alldifferent.}

\subsubsection{Test both implementations of alldifferent}

\subsubsection{What did you find in your comparative study?}

\end{document}
